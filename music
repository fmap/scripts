#!/usr/bin/env bash

root() {
  [[ -d /mnt/media/music ]] \
    && local share=/mnt/media/ \
    || local share=$HOME/usr/share
  echo "$share/music/."
}

ROOT="$(root)"

mode() {
  if [[ $1 == "-s" ]]; then
    echo "shuf"; return 0
  else
    echo "sort"; return 1
  fi
}

if [[ -z "$*" ]]; then
  find "$ROOT" -mindepth 2 -maxdepth 2 -type d \
    | sed "s'$ROOT/''" \
    | sort
else
  mode=$(mode $*) && shift
  find "$ROOT" -type f -print0 \
    | grep -Eazi "${@:-*}" \
    | grep -Eazi '\.(m4a|flac|mp3)$' \
    | $mode -z \
    | xargs -0 repeat play 
fi
